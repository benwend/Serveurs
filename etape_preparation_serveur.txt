*** 5 premières minutes sur un serveur Debian ***

** Source : http://blog.nicolargo.com/2013/03/mes-5-premieres-minutes-sur-un-serveur-debian.html

1) Création de compte :
	- Ne pas utiliser le compte root
	- Créer un compte qui se connectera avec sudo

2) SSH
	- Pousser la clé publique sur le serveur distant : ssh-copy-id morpheus@monserveur
	- Dans etc/ssh/sshd_config :
		_ Désactiver connexion root -> PermitRootLogin no
		_ Désactiver connexion par mot de passe -> PasswordAuthentication no
	- Relancer SSH : sudo service  ssh restart
			
3) Contrôler les entrées avec Fail2ban
	- Installer Fail2ban : sudo apt-get-install fail2ban
	- Éditer le fichier /etc/fail2ban/jail.conf :
		destemail = your@mail

		[ssh]
		enabled = true
		port = ssh
		filter = sshd
		action = iptables[name=SSH, port=ssh, protocol=tcp]
		logpath = /var/log/auth.log
		maxretry = 3
		bantime = 300

	- Relancer Fail2ban : sudo service fail2ban restart

4) Fermer les fenêtres du Firewall
	- sudo wget --no-check-certificate -O /etc/init.d/firewall.sh https://raw.github.com/nicolargo/debianpostinstall/master/firewall.sh
	- sudo chmod a+x /etc/init.d/firewall.sh
	- sudo update-rc.d firewall.sh defaults 20

5) Prendre soin de ses fondations en tenant son système à jour
	- sudo apt-get install cron-apt
	- sudo nano /etc/cron-apt/config
		MAILTO="contact@benjamin-wendling.fr"

6) Surveiller le tout avec Logwatch
	- sudo apt-get install logwatch
	- /usr/sbin/logwatch --output mail --mailto contact@benjamin-wendling.fr --detail high

7) Se prémunir contre les intrusions
	- Bloquer en temps réel la plupart des scans de port connus :
		_ Installer Porsentry :
			apt-get install portsentry
		_ Configurer Portsentry (nano /etc/portsentry/portsentry.conf) :
			Commentez les lignes KILL_HOSTS_DENY.
			Décommentez la ligne KILL_ROUTE="/sbin/iptables -I INPUT -s $TARGET$ -j DROP".
			Ainsi, Portsentry ajoutera une règle dans le firewall (iptables) pour rejeter les paquets en cas de scans.
		_ Lancer le logiciel par 2 fois pour les protocoles TCP et UDP :
			portsentry –audp
			portsentry –atcp
	- Bloquer les rootkits et backdoors :
		_ Installer Rkhunter :
			apt-get install rkhunter
		_ Configurer Rkhunter (nano /etc/default/rkhunter) :
			REPORT_EMAIL : indiquez un mail pour recevoir des alertes de Rkhunter ;
			CRON_DAILY_RUN : mettez « yes » pour une vérification quotidienne de votre machine via un cron.

8) Trucs & Astuces
	- Apache2 :
		_ nano /etc/apache2/apache2.conf
			ServerSignature=off
			ServerTokens=prod
	- MySQL :
		_ /usr/bin/mysql_secure_installation
	- FTP :
		_ Ne surtout pas créer de FTP anonymes
	- Mail :
		_ SpamAssassin
		_ Connexion sécurisées SSl ou TLS

9) Tester la sécurité du serveur
	- Scan de ports :
		_ Avec nmap :
			nmap -v IP_Serveur
	- Scan de vulnérabilité :
		_
